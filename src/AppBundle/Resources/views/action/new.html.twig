{% extends 'base.html.twig' %}

{% block plugin_stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('front/global/vendor/select2/select2.css') }}">
{% endblock %}

{% block head_javascripts %}
    {{ parent() }}
    <link id="skinStyle" href="{{ asset('front/mmenu/assets/skins/teal.css') }}" rel="stylesheet" type="text/css">
{% endblock %}

{% block page %}

    <div class="page animsition">
        <div class="page-header padding-top-20 padding-bottom-10">
            <ol class="breadcrumb">
                <li><a href="{{ path('plot_show',{'id':cropCycle.plot.id}) }}">{{ cropCycle.plot.name }}</a></li>
                <li><a href="{{ path('cropcycle_show',{'id':cropCycle.id}) }}">{{ cropCycle.name }}</a></li>
                <li class="active">Ajouter une intervention</li>
            </ol>
        </div>
        <div class="page-content">
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-bordered">
                        <div class="panel-heading">
                            <h3 class="panel-title">Ajouter une intervention</h3>
                        </div>
                        <div class="panel-body">
                            {{ form_start(form) }}
                            <div class="row">
                            <div class="col-lg-4">
                                <h4 class="example-title">
                                    {{ form_label(form.intervention) }}
                                </h4>
                            {{ form_widget(form.intervention) }}
                            </div>
                            </div>
                            <div>
                                {{ form_widget(form.periods) }}
                                <a href="#" id="add_period" class="btn btn-default">Ajouter une période</a>
                            </div>
                            <div>
                                {{ form_label(form.tractors) }}
                                {{ form_errors(form.tractors) }}
                                {{ form_widget(form.tractors) }}
                            </div>
                            <div>
                                {{ form_label(form.implements) }}
                                {{ form_errors(form.implements) }}
                                {{ form_widget(form.implements) }}
                            </div>
                        </div>
                        <div class="panel-footer">
                            <a class="btn btn-default"
                               href="{{ path('cropcycle_show',{'id':cropCycle.id}) }}">Annuler</a>
                            <button class="btn btn-primary margin-left-10" type="submit">Enregistrer</button>
                            {{ form_end(form) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block template_config %}
    {{ parent() }}
    <script src="{{ asset('front/global/vendor/select2/select2.min.js') }}"></script>
    <script src="{{ asset('front/global/js/components/select2.js') }}"></script>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript">
        $(document).ready(function () {
            var $container = $('div#action_periods');
            var index = $container.find(':input').length;
            $('#add_period').click(function (e) {
                addPeriod($container);

                e.preventDefault(); // évite qu'un # apparaisse dans l'URL
                return false;
            });

            if (index == 0) {
                addPeriod($container);
            } else {
                $container.children('div').each(function () {
                    addDeleteLink($(this));
                });
            }

            function addPeriod($container) {
                var template = $container.attr('data-prototype')
                        .replace(/__name__label__/g, 'Période ' + (index + 1))
                        .replace(/__name__/g, index)
                        ;

                var $prototype = $(template);
                addDeleteLink($prototype);
                $container.append($prototype);

                index++;
            }

            function addDeleteLink($prototype) {
                var $deleteLink = $('<a href="#" class="btn btn-danger">Supprimer</a>');
                $prototype.append($deleteLink);
                $deleteLink.click(function (e) {
                    $prototype.remove();

                    index--;

                    e.preventDefault();
                    return false;
                });
            }
        });

    </script>
{% endblock %}


