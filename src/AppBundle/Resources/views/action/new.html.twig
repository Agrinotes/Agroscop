{% extends 'base.html.twig' %}

{% block body %}
    <h1>Ajouter une intervention</h1>

    <a href="#" id="add_period" class="btn btn-default">Ajouter une période</a>

    {{ form_start(form) }}
    {{ form_widget(form) }}
    <input type="submit" value="Enregistrer"/>
    {{ form_end(form) }}

    <ul>
        <li>
            <a href="{{ path('cropcycle_show',{'id':cropCycle.id}) }}">Annuler</a>
        </li>
    </ul>
{% endblock %}

{% block javascripts %}
{{ parent() }}

<script type="text/javascript">
    $(document).ready(function () {
        var $container = $('div#action_periods');
        var index = $container.find(':input').length;
        $('#add_period').click(function (e) {
            addPeriod($container);

            e.preventDefault(); // évite qu'un # apparaisse dans l'URL
            return false;
        });

        if (index == 0) {
            addPeriod($container);
        } else {
            $container.children('div').each(function () {
                addDeleteLink($(this));
            });
        }

        function addPeriod($container) {
            var template = $container.attr('data-prototype')
                    .replace(/__name__label__/g, 'Période ' + (index + 1))
                    .replace(/__name__/g, index)
                    ;

            var $prototype = $(template);
            addDeleteLink($prototype);
            $container.append($prototype);

            index++;
        }

        function addDeleteLink($prototype) {
            var $deleteLink = $('<a href="#" class="btn btn-danger">Supprimer</a>');
            $prototype.append($deleteLink);
            $deleteLink.click(function (e) {
                $prototype.remove();

                index--;

                e.preventDefault();
                return false;
            });
        }
    });

</script>
{% endblock %}


