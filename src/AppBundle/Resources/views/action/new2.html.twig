{% extends 'base.html.twig' %}

{% block plugin_stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('front/global/vendor/select2/select2.css') }}">
    <link rel="stylesheet" href="{{ asset('front/global/vendor/bootstrap-datepicker/bootstrap-datepicker.css') }}">
    <link rel="stylesheet" href="{{ asset('front/global/vendor/jt-timepicker/jquery-timepicker.css') }}">
    {#<link rel="stylesheet" href="{{ asset('front/global/vendor/clockpicker/clockpicker.css') }}">#}
{% endblock %}

{% block head_javascripts %}
    {{ parent() }}
    <link id="skinStyle" href="{{ asset('front/mmenu/assets/skins/teal.css') }}" rel="stylesheet" type="text/css">
{% endblock %}

{% block page %}

<div class="page animsition">
    <div class="page-header padding-top-20 padding-bottom-10">
        <ol class="breadcrumb">
            <li><a href="{{ path('plot_show',{'id':cropCycle.plot.id}) }}">{{ cropCycle.plot.name }}</a></li>
            <li><a href="{{ path('cropcycle_show',{'id':cropCycle.id}) }}">{{ cropCycle.name }}</a></li>
            <li class="active">Ajouter une intervention</li>
        </ol>
    </div>
    <div class="page-content">
        <div class="row">
            <div class="col-lg-6 col-lg-offset-3">
                {% for flash_message in app.session.flashBag.get('success') %}
                    <div class="alert dark alert-alt alert-success alert-dismissible" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                        {{ flash_message }}
                    </div>
                {% endfor %}
                {{ form_start(form) }}

                <div class="panel">
                    <div class="panel-heading">
                        <h3 class="panel-title">{{ form_label(form.intervention) }}
                        </h3>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="form-group">
                                    {{ form_errors(form.intervention) }}

                                    {{ form_widget(form.intervention) }}
                                </div>
                            </div>
                        </div>
                        <a class="pull-right" href="{{ path('intervention_new') }}"><i class="icon md-help-outline"
                                                                                       aria-hidden="true"></i> Que
                            faire si mon intervention n'est pas dans la liste déroulante</a>
                    </div>
                </div>
                <div class="panel">
                    <div class="panel-heading">
                        <h3 class="panel-title">Définir les périodes d'intervention
                        </h3>

                        <div class="panel-actions">

                        </div>

                    </div>
                    <div class="panel-body">

                        <div class="row">
                            <div class="col-lg-12">



                                {% form_theme form 'AppBundle:form:datetime.html.twig' %}
                                {{ form_widget(form.periods) }}
                                <a class="pull-right" href="#" id="add_period"><i class="icon md-plus-circle-o"
                                                                                  aria-hidden="true"></i> Ajouter une autre
                                    période</a>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel">
                    <div class="panel-heading">
                        <h3 class="panel-title">Choisir le matériel utilisé
                        </h3>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-lg-12">
                                    {{ form_label(form.tractors) }}


                                {% if app.user.farm.tractors is not empty %}
                                    {{ form_errors(form.tractors) }}
                                    {{ form_widget(form.tractors) }}
                                {% else %}
                                    <div class="hidden">
                                        {{ form_errors(form.tractors) }}
                                        {{ form_widget(form.tractors) }}
                                    </div>
                                    <p>
                                        Vous n'avez pas enregistrer de tracteur sur l'exploitation
                                    </p>
                                {% endif %}
                            </div>
                            <div class="col-lg-12 margin-top-10">
                                    {{ form_label(form.implements) }}

                                {% if app.user.farm.implements is not empty %}
                                    {{ form_errors(form.implements) }}
                                    {{ form_widget(form.implements) }}
                                {% else %}
                                    <div class="hidden">
                                        {{ form_errors(form.implements) }}
                                        {{ form_widget(form.implements) }}
                                    </div>
                                    <p>
                                        Vous n'avez pas enregistrer d'outils sur l'exploitation
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-body">
                        <div class="panel-footer">
                            <a class="btn btn-default"
                               href="{{ path('cropcycle_show',{'id':cropCycle.id}) }}">Retourner à la culture</a>
                            <button class="btn btn-primary margin-left-10" type="submit">Enregistrer</button>
                            {{ form_end(form) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}

    {% block template_config %}
        {{ parent() }}
        <script src="{{ asset('front/global/vendor/select2/select2.min.js') }}"></script>
        <script src="{{ asset('front/global/js/components/select2.js') }}"></script>

        <script src="{{ asset('front/global/vendor/bootstrap-datepicker/bootstrap-datepicker.js') }}"></script>
        <script src="{{ asset('front/global/vendor/bootstrap-datepicker/bootstrap-datepicker.fr.js') }}"></script>
        <script src="{{ asset('front/global/vendor/jt-timepicker/jquery.timepicker.js') }}"></script>
        <script src="{{ asset('front/global/vendor/datepair-js/datepair.min.js') }}"></script>
        <script src="{{ asset('front/global/vendor/datepair-js/jquery.datepair.min.js') }}"></script>

        <script src="{{ asset('front/global/js/components/bootstrap-datepicker.js') }}"></script>
        <script src="{{ asset('front/global/js/components/jt-timepicker.js') }}"></script>
        <script src="{{ asset('front/global/js/components/datepair-js.js') }}"></script>

        {#
        <script src="{{ asset('front/global/vendor/clockpicker/bootstrap-clockpicker.min.js') }}"></script>
        <script src="{{ asset('front/global/js/components/clockpicker.js') }}"></script>
        #}
    {% endblock %}

    {% block javascripts %}
        {{ parent() }}

        <script type="text/javascript">
            $(document).ready(function () {
                var $container = $('div#action_periods');
                var index = $container.find(':input').length;
                $('#add_period').click(function (e) {
                    addPeriod($container);

                    e.preventDefault(); // évite qu'un # apparaisse dans l'URL
                    return false;
                });

                if (index == 0) {
                    addPeriod($container);

                } else {
                    $container.children('div').each(function () {
                        addDeleteLink($(this));
                    });
                }

                function addPeriod($container) {
                    var template = $container.attr('data-prototype')
                            .replace(/__name__label__/g, '')
                            .replace(/__name__/g, index)
                            .replace(/Start datetime/g, "Début d'intervention")
                            .replace(/End datetime/g, "Fin d'intervention")
                            .replace(/form-group/g, "form-group col-lg-12")


                            ;

                    var $prototype = $(template);
                    addDeleteLink($prototype);
                    $container.append($prototype);


                    $('input[id*="startDatetime_time"]').addClass("time start");
                    $('input[id*="startDatetime_date"]').addClass("date start");
                    $('input[id*="endDatetime_time"]').addClass("time end");
                    $('input[id*="endDatetime_date"]').addClass("date end");

                    // initialize input widgets first
                    $('.time').timepicker({
                        'showDuration': true,
                        'timeFormat': 'G:i',
                        'show2400': true
                    });

                    $('.date').datepicker({
                        'format': 'dd/mm/yyyy',
                        'startView': 'months',
                        'minView': 'days',
                        'language': 'fr',
                        'autoclose': true
                    });

                    // initialize datepair
                    var basicExampleEl = document.getElementById('action_periods_' + (index));
                    var datepair = new Datepair(basicExampleEl, {
                        anchor: 'null'
                    });

                    index++;
                }

                function addDeleteLink($prototype) {
                    var $deleteLink = $('<a href="#" style="position: absolute;top: -4px;left: -2px;"><i class="btn btn-pure btn-danger icon waves-effect waves-circle waves-classicr md-close-circle-o" aria-hidden="true"></i></a>');
                    $prototype.append($deleteLink);
                    $deleteLink.click(function (e) {
                        $prototype.remove();

                        index--;

                        e.preventDefault();
                        return false;
                    });
                }
            });
        </script>
    {% endblock %}



