<!DOCTYPE html>
<html class="no-js css-menubar" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta name="description" content="bootstrap admin template">
    <meta name="author" content="">
    <title>Agroscopik | Bienvenue sur votre exploitation</title>
    <link rel="apple-touch-icon" href="{{ asset('remark/3.0.5/classic/topbar/assets/images/apple-touch-icon.png') }}">
    <link rel="shortcut icon" href="{{ asset('remark/3.0.5/classic/topbar/assets/images/favicon.ico') }}">
    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/css/bootstrap-extend.min.css') }}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/topbar/assets/css/site.min.css') }}">
    <!-- Plugins -->
    <link rel="stylesheet" href="{{asset('remark/3.0.5/classic/global/vendor/animsition/animsition.min.css')}}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/vendor/asscrollable/asScrollable.min.css') }}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/vendor/switchery/switchery.min.css') }}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/vendor/intro-js/introjs.min.css') }}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/vendor/slidepanel/slidePanel.min.css') }}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/vendor/flag-icon-css/flag-icon.min.css') }}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/vendor/mapbox-js/mapbox.min.css') }}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/topbar/assets/examples/css/apps/location.css')}}">
    <!-- Fonts -->
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/fonts/font-awesome/font-awesome.min.css') }}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/fonts/web-icons/web-icons.min.css') }}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/fonts/brand-icons/brand-icons.min.css') }}">
    <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Roboto:300,400,500,300italic'>
    <link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
    <!--[if lt IE 9]>
    <script src="{{ asset('remark/3.0.5/classic/global/vendor/html5shiv/html5shiv.min.js') }}"></script>
    <![endif]-->
    <!--[if lt IE 10]>
    <script src="{{ asset('remark/3.0.5/classic/global/vendor/media-match/media.match.min.js')}}"></script>
    <script src="{{ asset('remark/3.0.5/classic/global/vendor/respond/respond.min.js') }}"></script>
    <![endif]-->
    <!-- Scripts -->
    <script src="{{ asset('remark/3.0.5/classic/global/vendor/breakpoints/breakpoints.min.js') }}"></script>
    <script>
        Breakpoints();
    </script>
</head>
<body class="animsition site-navbar-small app-location page-aside-scroll page-aside-left">
<!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
<![endif]-->
<nav class="site-navbar navbar navbar-default navbar-fixed-top navbar-mega navbar-inverse bg-cyan-600 " role="navigation">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler hamburger hamburger-close navbar-toggler-left hided"
                data-toggle="menubar">
            <span class="sr-only">Toggle navigation</span>
            <span class="hamburger-bar"></span>
        </button>
        <button type="button" class="navbar-toggler collapsed" data-target="#site-navbar-collapse"
                data-toggle="collapse">
            <i class="icon md-more" aria-hidden="true"></i>
        </button>
        <a class="navbar-brand navbar-brand-center" href="../../index.html">
            <span class="navbar-brand-text hidden-xs-down">AGROSCOPIK</span>
        </a>
    </div>
    <div class="navbar-container container-fluid">
        <!-- Navbar Collapse -->
        <div class="collapse navbar-collapse navbar-collapse-toolbar" id="site-navbar-collapse">
            <!-- Navbar Toolbar -->
            <ul class="nav navbar-toolbar">
                <li class="nav-item hidden-float" id="toggleMenubar">
                    <a class="nav-link" data-toggle="menubar" href="#" role="button">
                        <i class="icon hamburger hamburger-arrow-left">
                            <span class="sr-only">Toggle menubar</span>
                            <span class="hamburger-bar"></span>
                        </i>
                    </a>
                </li>
                <li class="nav-item hidden-sm-down" id="toggleFullscreen">
                    <a class="nav-link icon icon-fullscreen" data-toggle="fullscreen" href="#" role="button">
                        <span class="sr-only">Toggle fullscreen</span>
                    </a>
                </li>
            </ul>
            <!-- End Navbar Toolbar -->
            <!-- Navbar Toolbar Right -->
            <ul class="nav navbar-toolbar navbar-right navbar-toolbar-right">
                <li class="nav-item dropdown">
                    <a class="nav-link navbar-avatar" data-toggle="dropdown" href="#" aria-expanded="false"
                       data-animation="scale-up" role="button">
              <span class="avatar avatar-online">
                <img src="{{ asset('remark/3.0.5/classic/topbar/assets/portraits/5.jpg') }}" alt="...">
                <i></i>
              </span>
                    </a>
                    <div class="dropdown-menu" role="menu">
                        <a class="dropdown-item" href="javascript:void(0)" role="menuitem"><i class="icon md-account" aria-hidden="true"></i> Profil</a>
                        <a class="dropdown-item" href="javascript:void(0)" role="menuitem"><i class="icon md-settings" aria-hidden="true"></i> Paramètres</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="javascript:void(0)" role="menuitem"><i class="icon md-power" aria-hidden="true"></i> Déconnexion</a>
                    </div>
                </li>
            </ul>
            <!-- End Navbar Toolbar Right -->
        </div>
        <!-- End Navbar Collapse -->
    </div>
</nav>
<div class="site-menubar site-menubar-light">
    <div class="site-menubar-body">
        <div>
            <div>
                <ul class="site-menu" data-plugin="menu" style="font-weight: 500;">
                    <li class="site-menu-category">General</li>
                    <li class="site-menu-item">
                        <a href="{{ path('dashboard') }}">
                            <span class="site-menu-title">Carte</span>
                        </a>
                    </li>
                    <li class="site-menu-item">
                        <a href="{{ path('dashboard') }}">
                            <span class="site-menu-title">Planning</span>
                        </a>
                    </li>
                    <li class="site-menu-item">
                        <a href="{{ path('dashboard') }}">
                            <span class="site-menu-title">Synthèses</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="page">
    <!-- Firends Sidebar -->
    <div class="page-aside">
        <div class="page-aside-switch">
            <i class="icon md-chevron-left" aria-hidden="true"></i>
            <i class="icon md-chevron-right" aria-hidden="true"></i>
        </div>
        <div class="page-aside-inner">
            <!-- Firends List -->
            <div class="app-location-list page-aside-scroll">
                <div data-role="container">
                    <div data-role="content">
                        <div class="list-group row">
                            <div class="col-lg-12" style="
                                padding-right: 0px;
                                margin-bottom: 15px;
                                margin-top: 15px
                            ">
                                <a href="#" class="btn btn-info btn-block">
                                    Ajouter une parcelle
                                </a>
                            </div>

                        {% if farm.plots is not empty %}
                        {% for plot in farm.plots %}
                            <div class="list-group-item col-xs-12 col-xxl-6 col-lg-12 friend-info" data-friend-id="f_{{ loop.index0 }}">
                                <div class="card card-shadow">
                                    <div class="card-block text-xs-center bg-white p-20">
                                        <div class="friend-name" style="font-weight:500">{{ plot.name | capitalize }}
                                        </div>
                                        <div class="friend-title" style="font-weight:400">
                                            {{ plot.area|number_format(2, ',', ' ') }} ha
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                            {% endif
                             %}
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Firends List -->
        </div>
    </div>
    <!-- End Firends Sidebar -->
    <div class="page-main">
        <div id="map">
        </div>
    </div>
</div>



<!-- Core  -->
<script src="{{ asset('remark/3.0.5/classic/global/vendor/babel-external-helpers/babel-external-helpers.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/vendor/jquery/jquery.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/vendor/tether/tether.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/vendor/bootstrap/bootstrap.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/vendor/animsition/animsition.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/vendor/mousewheel/jquery.mousewheel.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/vendor/asscrollbar/jquery-asScrollbar.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/vendor/asscrollable/jquery-asScrollable.js') }}"></script>

<!-- Plugins -->
<script src="{{ asset('remark/3.0.5/classic/global/vendor/switchery/switchery.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/vendor/intro-js/intro.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/vendor/screenfull/screenfull.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/vendor/slidepanel/jquery-slidePanel.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/vendor/mapbox-js/mapbox.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/vendor/mapbox-js/leaflet.markercluster.js') }}"></script>

<script src="{{ asset('remark/3.0.5/classic/global/js/State.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/js/Component.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/js/Plugin.min.js') }}"></script>
<!-- Scripts -->
<script src="{{ asset('remark/3.0.5/classic/global/js/Base.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/js/Config.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/topbar/assets/js/Section/Menubar.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/topbar/assets/js/Section/Sidebar.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/topbar/assets/js/Section/PageAside.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/topbar/assets/js/Plugin/menu.min.js') }}"></script>
<!-- Config -->
<script src="{{ asset('remark/3.0.5/classic/global/js/config/colors.min.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/topbar/assets/js/config/tour.min.js') }}"></script>
<script>
    Config.set('assets', '{{ app.request.getBaseURL() }}/web/remark/3.0.5/classic/topbar/assets');
</script>
<!-- Page -->
<script src="{{ asset('remark/3.0.5/classic/topbar/assets/js/Site.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/js/Plugin/asscrollable.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/js/Plugin/slidepanel.js') }}"></script>
<script src="{{ asset('remark/3.0.5/classic/global/js/Plugin/switchery.js') }}"></script>

{# Map script #}
<script>
    (function (global, factory) {
        if (typeof define === "function" && define.amd) {
            define('/App/Location', ['exports', 'Site'], factory);
        } else if (typeof exports !== "undefined") {
            factory(exports, require('Site'));
        } else {
            var mod = {
                exports: {}
            };
            factory(mod.exports, global.Site);
            global.AppLocation = mod.exports;
        }
    })(this, function (exports, _Site2) {
        'use strict';

        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        exports.getInstance = exports.run = exports.AppLocation = undefined;

        var _Site3 = babelHelpers.interopRequireDefault(_Site2);

        var Map = function () {
            function Map() {
                babelHelpers.classCallCheck(this, Map);

                this.window = $(window);
                this.$siteNavbar = $('.site-navbar');
                this.$siteFooter = $('.site-footer');
                this.$pageMain = $('.page-main');

                this.handleMapHeight();
            }

            babelHelpers.createClass(Map, [{
                key: 'handleMapHeight',
                value: function handleMapHeight() {
                    var footerH = this.$siteFooter.outerHeight(),
                            navbarH = this.$siteNavbar.outerHeight();
                    var mapH = this.window.height() - navbarH - footerH - 50;
                    this.$pageMain.outerHeight(mapH);
                }
            }, {
                key: 'getMap',
                value: function getMap() {
                    L.mapbox.accessToken = 'pk.eyJ1IjoiaHVnb2xlaG91eCIsImEiOiItOHl6Sm5jIn0.12l_k0K_Z28UE-Jc0kDgpw';
                    var map = L.mapbox.map('map','mapbox.streets',{ zoomControl: false }).setView([38.8922,-77.0348], 14);
                    new L.Control.Zoom({ position: 'topright' }).addTo(map);

                    L.control.layers({
                        'Carte': L.mapbox.tileLayer('mapbox.streets').addTo(map),
                        'Image satellite': L.mapbox.tileLayer('mapbox.streets-satellite')
                    }).addTo(map);

                    return map;
                }
            }]);
            return Map;
        }();

        var Markers = function () {
            function Markers(friends, map) {
                babelHelpers.classCallCheck(this, Markers);

                this.friends = friends;
                this.map = map;
                this.allMarkers = [];

                this.handleMarkers();
            }

            babelHelpers.createClass(Markers, [{
                key: 'handleMarkers',
                value: function handleMarkers() {
                // Create FeatureGroup to handle the plots and cropCycles
                var featureGroup = L.featureGroup();
                var featureGroup2 = L.featureGroup();

                //Drawing polygons
                {% for plot in farm.plots %}
                    {% if plot.latLngs is not empty %}
                    // Add current polygon and add an attribute alt
                    var layer = L.geoJson({{ plot.latLngs | raw }});
                    //Set style
                    layer.setStyle({color: "white", Opacity:0.9, fillOpacity: 0.8, weight: 1.5});

                    //Add a popup
                    layer.bindPopup("<div class='friend-popup-info'><div class='detail'>" + "{{ plot.area | number_format(2,","," ") }} ha" + "</div><h3 class=\"margin-top-10\">" + "{{ plot.name | upper }}"+"</h3></div>", {closeButton: false});

                    // Add current polygon to featureGroup
                    featureGroup.addLayer(layer);
                    // Add it inside allMarkers array
                    this.allMarkers.push(layer);
                    console.log(self.allMarkers);
                    {% endif %}

                    // Add cropcycles polygons
                    {% for cycle in plot.cropCycles %}
                        {% if cycle.latLngs is not empty and cycle.status == "ActiveAction" %}
                                // Add current polygon and add an attribute alt
                                var layer2 = L.geoJson({{ cycle.latLngs | raw }});
                                var color = "red";
                                {% for crop in cycle.crops %}
                                var color = "{{ crop.color }}";
                                {% endfor %}
                                //Set style
                                layer2.setStyle({color: color, Opacity:1, fillOpacity: 0.8, weight: 1.5});
                                //Add a popup
                                layer2.bindPopup("<div class='friend-popup-info'><div class='detail'>" + "{{ cycle.area | number_format(2,","," ") }} ha" + "</div><h3 class=\"margin-top-10\" style=\"font-weight: 500;color:#76838f;    text-transform: capitalize;\"><a href=\"{{ path('action_new',{'id':cycle.id}) }}\">" + "{{ cycle.name | capitalize }}"+"</a></h3><p>sur la parcelle " +"{{plot.name | capitalize}}"+"</p></div></div>", {closeButton: false});
                                // Add current polygon to featureGroup
                                featureGroup2.addLayer(layer2);
                        {% endif %}
                    {% endfor %}

                {% endfor %}
                // Add plots to the map
                featureGroup.addTo(this.map);
                featureGroup2.addTo(this.map);             

                //Zoom to farm bounds
                var bounds = featureGroup.getBounds();
                this.map.fitBounds(bounds);  
                }
            }, {
                key: 'getAllMarkers',
                value: function getAllMarkers() {
                    return this.allMarkers;
                }
            }]);
            return Markers;
        }();

        var AppLocation = function (_Site) {
            babelHelpers.inherits(AppLocation, _Site);

            function AppLocation() {
                babelHelpers.classCallCheck(this, AppLocation);
                return babelHelpers.possibleConstructorReturn(this, (AppLocation.__proto__ || Object.getPrototypeOf(AppLocation)).apply(this, arguments));
            }

            babelHelpers.createClass(AppLocation, [{
                key: 'processed',
                value: function processed() {
                    babelHelpers.get(AppLocation.prototype.__proto__ || Object.getPrototypeOf(AppLocation.prototype), 'processed', this).call(this);

                    this.window = $(window);
                    this.$listItem = $('.app-location .page-aside .list-group');
                    this.allFriends = $('.app-location .friend-info');
                    this.mapbox = new Map();

                    this.map = this.mapbox.getMap();
                    this.markers = new Markers(this.$allFriends, this.map);
                    this.allMarkers = this.markers.getAllMarkers();

                    this.friendNum = null;

                    this.handleResize();
                }
            }, {
                key: 'getDefaultState',
                value: function getDefaultState() {
                    return Object.assign(babelHelpers.get(AppLocation.prototype.__proto__ || Object.getPrototypeOf(AppLocation.prototype), 'getDefaultState', this).call(this), {
                        mapChange: true,
                        listItemActive: false
                    });
                }
            }, {
                key: 'handleResize',
                value: function handleResize() {
                    var _this4 = this;

                    this.window.on('resize', function () {
                        _this4.mapbox.handleMapHeight();
                    });
                }
            }]);
            return AppLocation;
        }(_Site3.default);

        var instance = null;

        function getInstance() {
            if (!instance) {
                instance = new AppLocation();
            }
            return instance;
        }

        function run() {
            var app = getInstance();
            app.run();
        }

        exports.default = AppLocation;
        exports.AppLocation = AppLocation;
        exports.run = run;
        exports.getInstance = getInstance;
    });

</script>
<script src="{{ asset('remark/3.0.5/classic/topbar/assets/examples/js/apps/location.js') }}"></script>
</body>
</html>