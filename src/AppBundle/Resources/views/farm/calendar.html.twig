

{% extends 'base.html.twig' %}

    {% block head_javascripts %}
        {{ parent() }}
        <link id="skinStyle" href="{{ asset('front/mmenu/assets/skins/teal.css') }}" rel="stylesheet" type="text/css">
    {% endblock %}

{% block plugin_stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('front/global/vendor/fullcalendar/fullcalendar.css') }}">
    <link rel="stylesheet" href="{{ asset('front/global/vendor/bootstrap-datepicker/bootstrap-datepicker.css') }}">
    <link rel="stylesheet" href="{{ asset('front/global/vendor/bootstrap-touchspin/bootstrap-touchspin.css') }}">
    <link rel="stylesheet" href="{{ asset('front/global/vendor/jquery-selective/jquery-selective.css') }}">
    <link rel="stylesheet" href="{{ asset('front/global/vendor/fullcalendar/fullcalendar.css') }}">


    <link rel="stylesheet" href="{{ asset('front/mmenu/assets/examples/css/apps/calendar.css') }}">
{% endblock %}

{% block body_class %}
    site-navbar-small app-calendar
{% endblock %}

{% block page %}
    <div class="page animsition">
        <div class="page-main">
            <div class="calendar-container">
                <div id="calendar"></div>
                <!--AddEvent Dialog -->

            </div>
        </div>
    </div>


    {% endblock %}

    {% block core_plugin %}
        {{ parent() }}

        <script src="{{ asset('front/global/vendor/jquery-ui/jquery-ui.min.js') }}"></script>
        <script src="{{ asset('front/global/vendor/moment/moment.min.js') }}"></script>
        <script src="{{ asset('front/global/vendor/fullcalendar/fullcalendar.js') }}"></script>
        <script src="{{ asset('front/global/vendor/fullcalendar/lang/fr.js') }}"></script>
        <script src="{{ asset('front/global/vendor/jquery-selective/jquery-selective.min.js') }}"></script>
        <script src="{{ asset('front/global/vendor/bootstrap-datepicker/bootstrap-datepicker.js') }}"></script>
        <script src="{{ asset('front/global/vendor/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js') }}"></script>
        <script src="{{ asset('front/global/vendor/bootbox/bootbox.js') }}"></script>
    {% endblock %}


    {% block template_config %}
        {{ parent() }}
        <script src="{{ asset('front/global/js/components/bootstrap-touchspin.js') }}"></script>
        <script src="{{ asset('front/global/js/components/bootstrap-datepicker.js') }}"></script>
        <script src="{{ asset('front/global/js/components/material.js') }}"></script>
        <script src="{{ asset('front/global/js/plugins/action-btn.js') }}"></script>
        <script src="{{ asset('front/global/js/components/bootbox.js') }}"></script>
        <script src="{{ asset('front/mmenu/assets/js/app.js') }}"></script>
        <script src="{{ asset('front/mmenu/assets/examples/js/apps/calendar.js') }}"></script>


        <script>
            window.AppCalendar = Site.extend({
                handleFullcalendar: function() {
                    var my_events = [
                        {% for action in actions %}
                        {
                            title: '{{ action.cropCycle.plot.name }} - {{ action.intervention.name }}',
                            start: '{{ action.startDatetime | date('Y-m-d\\Tg:ia') }}',
                            end: '{{ action.endDatetime | date('Y-m-d\\Tg:ia') }}',
                            backgroundColor: $.colors("cyan", 600),
                            borderColor: $.colors("cyan", 600)
                        }{% if not loop.last %},{% endif %}
                        {% endfor %}
                        ];
                    var actionBtn = $('.site-action').actionBtn().data('actionBtn');
                    var my_options = {
                        header: {
                            left: null,
                            center: 'prev,title,next',
                            right: 'month,agendaWeek,agendaDay'
                        },
                        defaultDate: '{{ "now"|date("Y-m-d") }}',
                        selectable: false,
                        selectHelper: false,
                        select: function() {
                            $('#addNewEvent').modal('show');
                        },
                        editable: false,
                        eventLimit: true,
                        windowResize: function(view) {
                            var width = $(window).outerWidth();
                            var options = $.extend({}, my_options);
                            options.events = view.calendar.getEventCache();
                            options.aspectRatio = width < 667 ? 0.5 : 1.5;

                            $('#calendar').fullCalendar('destroy');
                            $('#calendar').fullCalendar(options);
                        },
                        eventClick: function(event) {
                            var color = event.backgroundColor ? event.backgroundColor : $.colors('blue', 600);
                            $('#editEname').val(event.title);


                            $('#editNewEvent').modal('show').one('hidden.bs.modal', function(e) {
                            })
                        },
                        eventDragStart: function() {
                            actionBtn.show();
                        },
                        eventDragStop: function() {
                            actionBtn.hide();
                        },
                        events: my_events,
                        droppable: true
                    };

                    var _options;
                    var my_options_mobile = $.extend({}, my_options);

                    my_options_mobile.aspectRatio = 0.5;
                    _options = $(window).outerWidth() < 667 ? my_options_mobile : my_options;

                    $('#editNewEvent').modal();
                    $('#calendar').fullCalendar(_options);
                },


                handleEventList: function() {
                    $('#addNewEventBtn').on('click', function() {
                        $('#addNewEvent').modal('show');
                    });

                    $('.calendar-list .calendar-event').each(function() {
                        var $this = $(this),
                                color = $this.data('color').split('-');
                        $this.data('event', {
                            title: $this.data('title'),
                            stick: $this.data('stick'),
                            backgroundColor: $.colors(color[0], color[1]),
                            borderColor: $.colors(color[0], color[1])
                        });
                        $this.draggable({
                            zIndex: 999,
                            revert: true,
                            revertDuration: 0,
                            helper: function() {
                                return '<a class="fc-day-grid-event fc-event fc-start fc-end" style="background-color:' + $.colors(color[0], color[1]) + ';border-color:' + $.colors(color[0], color[1]) + '">' +
                                        '<div class="fc-content">' +
                                        '<span class="fc-title">' + $this.data('title') + '</span>' +
                                        '</div>' +
                                        '</a>';
                            }
                        });
                    });
                },


                run: function(next) {

                    $('#addNewEvent').modal({
                        show: false
                    });



                    this.handleEventList();
                    this.handleFullcalendar();

                    next();
                }
            });

            $(document).ready(function() {
                AppCalendar.run();

            });
        </script>

    {% endblock %}
