{% extends 'base_topbar.html.twig' %}

{% block title %}{{cropCycle.plot.name | capitalize }} {{ cropCycle.name | capitalize }}{% endblock %}

{% block plugins_stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/vendor/datatables-bootstrap/dataTables.bootstrap.css') }}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/vendor/datatables-fixedheader/dataTables.fixedHeader.css') }}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/vendor/datatables-responsive/dataTables.responsive.css') }}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/topbar/assets/examples/css/tables/datatable.css') }}">
    <link rel="stylesheet" href="{{ asset('remark/3.0.5/classic/global/vendor/jquery-wizard/jquery-wizard.css') }}">
{% endblock %}

{% block page_stylesheets %}
{{parent() }}
<style>
  table tr > td > span > button > i.icon{
      visibility: hidden;
  }

    table tr > td > span > a > i.icon{
      visibility: hidden;
  }

  table tr:hover > td > span > button > i.icon{
      visibility: visible;
  }

    table tr:hover > td > span > a > i.icon{
      visibility: visible;
  }

  .actionLink{
    text-decoration:none !important;
    color: #526069;
  }
   table tr:hover > td > a.actionLink{
    text-decoration:underline !important;
    color: #526069;
  }
</style>
{% endblock %}

{% block page %}
    <div class="page-content">
   <!-- Panel Basic -->
      <div class="panel" style="display:none;">
        <header class="panel-heading">
          <div class="panel-actions"></div>
          <h3 class="panel-title">{{ cropCycle.name }}</h3>
        </header>
        <div class="panel-body">
          <table class="table table-hover dataTable table-striped w-full" data-plugin="dataTable">
            <thead>
              <tr>
                <th>Temporary fix here</th>
              </tr>
            </thead>
            <tfoot>
              <tr>
                <th>Temporary fix here</th>
              </tr>
            </tfoot>
<tbody></tbody>
          </table>
        </div>
      </div>
      <!-- End Panel Basic -->


      <!-- Panel Table Tools -->
      <div class="panel">
        <header class="panel-heading">
          <h3 class="panel-title">{{ cropCycle.name | upper }}</h3>
        </header>
        <div class="panel-body">
          <table class="table table-hover dataTable table-striped w-full" id="exampleTableTools">
            <thead>
              <tr>
                <th>Intervention</th>
                <th>Date</th>
                <th>Personnes</th>
                <th>Temps de travail</th>
                <th>Coûts associés</th>
              </tr>
            </thead>
            <tbody>
            {% for action in cropCycle.actions %}
              <tr id="td_{{action.id}}">
                <td><a class="actionLink" href="{{ path('action_show',{'id':action.id}) }}">{{action.name}} </a>
                
                <span class="pull-right"><a href="{{path('action_edit',{'id':action.id})}}" class="btn btn-sm btn-icon btn-pure btn-default on-default edit-row" style="padding:0px 5px 0px;" data-toggle="tooltip" data-original-title="Modifier"><i class="icon wb-edit" aria-hidden="true"></i></a>
                  <button 
                  
                  onClick="
                  swal({
  title: 'Supprimer l\'intervention ?',
  text: 'Cette suppression sera définitive',
  type: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#DD6B55',
  confirmButtonText: 'Confirmer',
  cancelButtonText: 'Annuler',
  closeOnConfirm: true,
  closeOnCancel: true,
},
function(isConfirm){
  if (isConfirm) {
                    $.ajax('{{path('action_delete_ajax',{'id':action.id})}}').done(function() {
                        $('#td_{{action.id}}').hide(200);
                  })
                  .fail(function() {
                        swal('Erreur', 'Il y a eu une erreur', 'error');
                  });    } 
});

                  "

                  
                  class="btn btn-sm btn-icon btn-pure btn-default on-default remove-row " style="padding:0px 5px 0px;" data-toggle="tooltip" data-original-title="Supprimer"><i class="icon wb-trash" aria-hidden="true"></i></button>
               </span></td>
                               <td>{{action.startDatetime | date ('d/m/Y')}}</td>
                <td>{{action.nbWorkers}}</td>

                <td>{{action.workingDurationLabel}}</td>
                <td>{{action.expensesCost |number_format(0, ',', ' ')}} CFP</td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <!-- End Panel Table Tools -->
          
{{render(controller('AppBundle:Action:newFromCropCycle',{'id':cropCycle.id}))}}

    </div>
{% endblock %}

{% block plugins_javascripts %}
    {{ parent() }}
    <script src="{{ asset('remark/3.0.5/classic/global/vendor/datatables/jquery.dataTables.js') }}"></script>
    <script src="{{ asset('remark/3.0.5/classic/global/vendor/datatables-fixedheader/dataTables.fixedHeader.js') }}"></script>
    <script src="{{ asset('remark/3.0.5/classic/global/vendor/datatables-bootstrap/dataTables.bootstrap.js') }}"></script>
    <script src="{{ asset('remark/3.0.5/classic/global/vendor/datatables-responsive/dataTables.responsive.js') }}"></script>
    <script src="{{ asset('remark/3.0.5/classic/global/vendor/datatables-tabletools/dataTables.tableTools.js') }}"></script>
    <script src="{{ asset('remark/3.0.5/classic/global/vendor/asrange/jquery-asRange.min.js') }}"></script>
    <script src="{{ asset('remark/3.0.5/classic/global/vendor/bootbox/bootbox.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.13/sorting/datetime-moment.js"></script>
    
    <script src="{{ asset('remark/3.0.5/classic/global/vendor/jquery-wizard/jquery-wizard.js') }}"></script>
{% endblock %}

{% block page_javascripts %}
    {{ parent() }}
    <script src="{{ asset('remark/3.0.5/classic/global/js/Plugin/datatables.js') }}"></script> 
    <script>
    /*!
 * remark (http://getbootstrapadmin.com/remark)
 * Copyright 2016 amazingsurge
 * Licensed under the Themeforest Standard Licenses
 */
(function(document, window, $) {
  'use strict';

  var Site = window.Site;

  $(document).ready(function($) {
    Site.run();
  });


  // Table Tools
  // -----------
  (function() {

    $(document).ready(function() {
      {# Sort dates #}
      $.fn.dataTable.moment( 'DD/MM/YYYY' );

      {# Sort hectares and CFP #}
      $.fn.dataTableExt.oSort['formatted-num-pre']=function(a){
                a = (a === "-" || a === "") ? 0 : a.replace( /[^\d\-\.]/g, "" );
        return parseFloat( a );
    }

          $.fn.dataTableExt.oSort['formatted-num-asc']=function(a, b){
 return a - b;
    }
              $.fn.dataTableExt.oSort['formatted-num-desc']=function(a, b){
 return b-a;
    }

      var defaults = Plugin.getDefaults("dataTable");

      var options = $.extend(true, {}, defaults, {
             columnDefs: [
       { type: 'formatted-num', targets: [3,4] }
     ],
        "order": [[ 1, "desc" ]],
        "iDisplayLength": 10,
        "aLengthMenu": [
          [5, 10, 25, 50, -1],
          [5, 10, 25, 50, "All"]
        ],
        "sDom": '<"dt-panelmenu clearfix"Tfr>t<"dt-panelfooter clearfix"ip>',
        "oTableTools": {
          "sSwfPath": "{{ asset('remark/3.0.5/classic/global/vendor/datatables-tabletools/swf/copy_csv_xls_pdf.swf') }}"
        }
      });

      $('#exampleTableTools').dataTable(options);
    });
  })();


})(document, window, jQuery);

    </script>

    <script src="{{ asset('remark/3.0.5/classic/global/js/Plugin/jquery-wizard.js') }}"></script> 
      <script>
        // Example Wizard Form Container
  // -----------------------------
  // http://formvalidation.io/api/#is-valid-container
  (function() {
    var defaults = Plugin.getDefaults("wizard");
    var options = $.extend(true, {}, defaults, {
      onFinish: function() {
        // $('#exampleFormContainer').submit();
      },
      buttonsAppendTo: '.panel-body'
    });

    $("#exampleWizardFormContainer").wizard(options);
  })();
      </script> 

{% endblock %}
